<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>人脸识别前端 demo | 微笑的蛋壳呀</title>
    <meta name="description" content="饭要一口一口吃，路要一步一步走">
    
    
    <link rel="preload" href="/assets/css/0.styles.f3e3bf20.css" as="style"><link rel="preload" href="/assets/js/app.f3aa7ae7.js" as="script"><link rel="preload" href="/assets/js/2.8b2ad26f.js" as="script"><link rel="preload" href="/assets/js/3.dee5c784.js" as="script"><link rel="prefetch" href="/assets/js/10.8a0e92ce.js"><link rel="prefetch" href="/assets/js/11.f3ad8ed2.js"><link rel="prefetch" href="/assets/js/12.3fa3dcfc.js"><link rel="prefetch" href="/assets/js/13.0e84be05.js"><link rel="prefetch" href="/assets/js/14.1a723e63.js"><link rel="prefetch" href="/assets/js/15.0d028931.js"><link rel="prefetch" href="/assets/js/16.31b6de59.js"><link rel="prefetch" href="/assets/js/17.eeb4f597.js"><link rel="prefetch" href="/assets/js/18.681ccb12.js"><link rel="prefetch" href="/assets/js/4.fb7e678d.js"><link rel="prefetch" href="/assets/js/5.f36453ad.js"><link rel="prefetch" href="/assets/js/6.44f369e7.js"><link rel="prefetch" href="/assets/js/7.49f031c1.js"><link rel="prefetch" href="/assets/js/8.cb967335.js"><link rel="prefetch" href="/assets/js/9.b02a9ea0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f3e3bf20.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">微笑的蛋壳呀</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/frontEnd/" class="nav-link router-link-active">前端</a></div><div class="nav-item"><a href="/backEnd/" class="nav-link">后台</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">链接</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/sherry_chan" target="_blank" rel="noopener noreferrer" class="nav-link external">
  csdn
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/smilechenjia/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/frontEnd/" class="nav-link router-link-active">前端</a></div><div class="nav-item"><a href="/backEnd/" class="nav-link">后台</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">链接</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/sherry_chan" target="_blank" rel="noopener noreferrer" class="nav-link external">
  csdn
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/smilechenjia/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/frontEnd/" class="sidebar-link">使用vuepress搭建博客</a></li><li><a href="/frontEnd/nginx.html" class="sidebar-link">部署vue前端项目到服务器上（nginx处理跨域）</a></li><li><a href="/frontEnd/vue.html" class="sidebar-link">如何使用vue-cli 3.0搭建多页面应用</a></li><li><a href="/frontEnd/node.html" class="sidebar-link">如何将node.js部署到服务器上</a></li><li><a href="/frontEnd/nginxh5.html" class="sidebar-link">如何使用nginx解决前端跨域问题</a></li><li><a href="/frontEnd/mobile.html" class="sidebar-link">用H5开发移动端页面的两三事</a></li><li><a href="/frontEnd/rnmac.html" class="sidebar-link">Mac下搭建react-native环境(ios)</a></li><li><a href="/frontEnd/rn1.html" class="sidebar-link">说说react-native那些事儿</a></li><li><a href="/frontEnd/face.html" class="active sidebar-link">人脸识别前端 demo</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontEnd/face.html#demo使用" class="sidebar-link">demo使用</a></li><li class="sidebar-sub-header"><a href="/frontEnd/face.html#技术点拆分" class="sidebar-link">技术点拆分</a></li></ul></li><li><a href="/frontEnd/ipu.html" class="sidebar-link">如何在ipu里使用vue</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="人脸识别前端-demo"><a href="#人脸识别前端-demo" aria-hidden="true" class="header-anchor">#</a> 人脸识别前端 demo</h1> <p><code>2019-11-18</code></p> <div class="tip custom-block"><p>本文使用h5、css、jquery做一个人脸识别前端demo，主要用于移动端。demo共有四个页面：首页、注册页、拍照登陆页、实时登陆页</p></div> <h2 id="demo使用"><a href="#demo使用" aria-hidden="true" class="header-anchor">#</a> demo使用</h2> <ol><li>进入demo就是首页，首页有三个引导框，点击进入其他页面</li></ol> <p><img src="/assets/img/index.32a8fd39.png" alt="avatar"></p> <ol start="2"><li>进入注册页
点击首页的“注册”即可跳转到注册页，注册页采用人脸注册方式，上传人脸的方式是使用拍照功能或者直接从相册里选择。在上传好照片后，demo会调用人脸检测接口，在照片上标出人脸轮廓。照片上传好以及信息填好后点击提交，demo会调用人脸注册接口，接口将照片存入后台图库，注册成功后跳转到首页</li></ol> <p><img src="/assets/img/regist.bfbf2c12.png" alt="avatar"></p> <ol start="3"><li>进入拍照登陆页
在首页点击“拍照登陆”即可进入拍照登陆页，还是采用人脸登陆方式，上传人脸的方式是使用拍照功能或者直接从相册里选择。上传好照片后，demo会调用人脸检测接口，在照片上标出人脸轮廓。点击提交，demo会调用人脸检索接口，接口将上传的照片与后台图库进行对比，如果相似度大于90%就返回登陆成功。当登陆成功后，界面显示个人注册的信息。</li></ol> <p><img src="/assets/img/login1.fffb1fb6.png" alt="avatar"></p> <p><img src="/assets/img/login2.137677a3.png" alt="avatar"></p> <ol start="4"><li>进入实时登陆页
在首页点击“实时登陆”进入实时登陆页，点击“开始识别”则开启摄像头，每两秒绘制图像并调用人脸检索接口，直至匹配成功，停止识别并返回注册的信息。识别中途用户点击“停止识别”也可以停止调用接口</li></ol> <p><img src="/assets/img/realtime.9dc8f765.png" alt="avatar"></p> <h2 id="技术点拆分"><a href="#技术点拆分" aria-hidden="true" class="header-anchor">#</a> 技术点拆分</h2> <ol><li>实现上传照片：手机拍照或从相册选择</li></ol> <p>方法：使用h5的input标签，type属性设置为file，accept属性设置为image/*</p> <p>代码：</p> <div class="language- extra-class"><pre class="language-text"><code>html:

&lt;input id=&quot;file&quot; name=&quot;file&quot; type=&quot;file&quot; accept=&quot;image/*&quot;/&gt;
</code></pre></div><ol start="2"><li>input file自带样式不满足要求</li></ol> <p>方法：把input在页面上隐藏了，并且使用div自己定义一个“拍照”按钮的样式，当点击这个div时，调用input的点击事件</p> <p>代码:</p> <div class="language- extra-class"><pre class="language-text"><code>html:

&lt;div id=&quot;cambtn&quot; class=&quot;btn&quot;&gt;拍照/相册&lt;/div&gt; 
&lt;input id=&quot;file&quot; name=&quot;file&quot; type=&quot;file&quot; accept=&quot;image/*&quot;/&gt;
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>css:

#file {
  display: none;
}

#cambtn {
  /*自定义样式*/
}
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>javascript:

$('#cambtn').click(function(){
  $('#file').click();
})
</code></pre></div><ol start="3"><li>iphone手机拍照后照片会顺时针旋转90度，需要在调用接口前将照片正过来</li></ol> <p>方法：使用exif.js和canvas</p> <p>canvas绘制图像，利用它把图片逆时针旋转90度</p> <p>exif可以读取拍摄的照片的具体信息，其中Orientation表示旋转角度，具体取值如下：</p> <table><thead><tr><th style="text-align:center;">照片旋转角度</th> <th style="text-align:center;">值</th></tr></thead> <tbody><tr><td style="text-align:center;">0度</td> <td style="text-align:center;">1</td></tr> <tr><td style="text-align:center;">顺时针90度</td> <td style="text-align:center;">6</td></tr> <tr><td style="text-align:center;">逆时针90度</td> <td style="text-align:center;">8</td></tr> <tr><td style="text-align:center;">180度</td> <td style="text-align:center;">3</td></tr></tbody></table> <p>可以前往exif下载exif.js，之后在script标签中引用，当Orientation值为6时更正图片位置</p> <p>代码：</p> <div class="language- extra-class"><pre class="language-text"><code>html:

&lt;input id=&quot;file&quot; name=&quot;file&quot; type=&quot;file&quot; accept=&quot;image/*&quot;/&gt;    &lt;!--上传照片--&gt;
&lt;canvas id=&quot;myCanvas&quot; style=&quot;display: none&quot;&gt;&lt;/canvas&gt;   &lt;!--辅助用--&gt;
&lt;img src=&quot;&quot; id=&quot;ago&quot; style=&quot;display: none;&quot;/&gt;

</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>javascript:

var $files = document.querySelector(&quot;#file&quot;);
var file = $files.files[0];  //获取上传的照片
var agoimg = document.querySelector(&quot;#ago&quot;);//用于保存上传的原始图片
var Orientation = null;

//获得图片旋转角度
EXIF.getData(file, function() {
  Orientation = EXIF.getTag(this, 'Orientation');
});
var reader = new FileReader();  //创建filereader对象
reader.readAsDataURL(file);     //转换数据
reader.onload = function(e){    //加载成功时触发的事件
  var image = new Image();
  image.src = e.target.result;
  agoimg.src = e.target.result;
  agoimg.onload = function() {
    var canvas = document.getElementById('myCanvas');
    canvas.width = this.naturalWidth;
    canvas.height = this.naturalHeight;
    var ctx = canvas.getContext(&quot;2d&quot;);
    //ios拍摄出来的照片：Orientation属性为6 
    if (Orientation === 6) {
      ctx.save(); //保存状态
      ctx.translate(canvas.width/2, canvas.height/2);  //设置画布上的(0,0)位置，也就是旋转的中心点
      ctx.rotate(90 * Math.PI / 180);  //把画布旋转90度
      //把图片绘制在画布translate之前的中心点
      ctx.drawImage(image, -(canvas.width/2), -(canvas.height/2), canvas.width, 
      canvas.height);   
      ctx.restore();    //恢复状态
    }
    else {
      ctx.drawImage(image, 0, 0, canvas.width, canvas.height);
    }
    var base64 = null;
    base64 = canvas.toDataURL(&quot;image/jpeg&quot;);  //转化成base64字符串
  }
}
         
</code></pre></div><ol start="4"><li>由于后台接口接收的图片的格式是二进制流的，所以需要把现有的base64字符串转化成二进制流</li></ol> <p>解决方法：先把base64字符串解码，再把字符串中的每一个字符转化成Unicode编码，最后再基于此创建一个blob对象</p> <p>代码：</p> <div class="language- extra-class"><pre class="language-text"><code>javascript:

var bytes = window.atob((base64).split(',')[1]);   //字符串解码
var array = [];
for(var i = 0; i &lt; bytes.length; i++){    //每一个字符转化成unicode编码
  array.push(bytes.charCodeAt(i));
}
var blob = new Blob([new Uint8Array(array)],{type:'image/jpeg'}); //创建二进制流blob对象
</code></pre></div><p>5.调用摄像头实时识别</p> <p>解决方法：使用navigator.mediaDevices.getUserMedia获取用户设备，并将视频流设置为video元素的源，最后使用canvas绘制video的成像</p> <p>代码：</p> <div class="language- extra-class"><pre class="language-text"><code>html: 

&lt;video id=&quot;video&quot; width=&quot;300&quot; height=&quot;300&quot; autoplay&gt;&lt;/video&gt;
&lt;canvas id=&quot;canvas&quot; style=&quot;display:none;&quot; width=&quot;300&quot; height=&quot;300&quot;&gt;&lt;/canvas&gt;
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>javascript:


var canvas = document.getElementById(&quot;canvas&quot;);
var context = canvas.getContext(&quot;2d&quot;);
var video = document.getElementById(&quot;video&quot;);

if (navigator.mediaDevices === undefined) {
  navigator.mediaDevices = {};
}
      
if (navigator.mediaDevices.getUserMedia === undefined) {
  navigator.mediaDevices.getUserMedia = function (constraints) {
    var getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
    if (!getUserMedia) {
      return Promise.reject(new Error('getUserMedia is not implemented in this browser'));
    }
    return new Promise(function (resolve, reject) {
      getUserMedia.call(navigator, constraints, resolve, reject);
    });
  }
}
var constraints = { audio: false, video: {width: 720,height:720} }
navigator.mediaDevices.getUserMedia(constraints)
        .then(function (stream) {
          var video = document.querySelector('video');
          if (&quot;srcObject&quot; in video) {
            video.srcObject = stream;
          } else {
            video.src = window.URL.createObjectURL(stream);
          }
          video.onloadedmetadata = function (e) {
            video.play();
          };
        })
        .catch(function (err) {
          console.log(err.name + &quot;: &quot; + err.message);
        });
      
context.drawImage(video, 0, 0, 300, 300);
</code></pre></div><blockquote><p>具体源代码可至<a href="https://github.com/smilechenjia/face" target="_blank" rel="noopener noreferrer">我的github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>查看</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/frontEnd/rn1.html" class="prev">
          说说react-native那些事儿
        </a></span> <span class="next"><a href="/frontEnd/ipu.html">
          如何在ipu里使用vue
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f3aa7ae7.js" defer></script><script src="/assets/js/2.8b2ad26f.js" defer></script><script src="/assets/js/3.dee5c784.js" defer></script>
  </body>
</html>
